题目二：
===
2. 淘宝上有几亿的买家和千万级的商家，我们需要在每个月初给头部的商家（已知商家的名单）推荐一定数量的用户，便于商家有针对性的进行营销活动。
要求：

a.     请给出具体的方案和实现方法，包括所用的模型、数据、训练和预测的方法。

b.     已有的数据是过去半年所有买家的行为数据，即过去半年的每一天里，单个买家在每个商品上的浏览、收藏、推荐，和购买数量。

1.数据分析
----
现有数据为过去半年所有买家的行为数据，即过去半年的每一天里，单个买家在每个商品的浏览、收藏、推荐和购买数量。需要为特定商家推荐用户。我们推荐的用户应该是有意愿购买该商店商品的，因此问题可以转化为预测用户在下个月内对该商店种类商品的购买行为，即预测某用户在下个月是否会购买该商店商品或与该商店商品类似的商品。
样本结构设计为（用户，商品，是否购买），即X = （用户，商品，日期等其他特征），y = {0,1}（0代表未购买，1代表购买）。评价指标可以使用经典的F1指标。

2.数据清洗
---
考虑到所给的数据量非常大，如果使用所有买家对所有商品的所有日期的所有交互，不但训练困难，而且包含了大量无效信息，降低模型准确率。
因此要对数据进行过滤与清洗：

1. 去除过去半年内只有浏览收藏或推荐行为而没有购买行为的用户
2. 结合业务场景，一般很久以前的浏览和推荐记录很难转化为购买，而收藏记录的影响时间则会稍长一些。因此去除除预测月份之前一个月的其他五个月的所有浏览和推荐数据（具体），去除预测月份之前三个月的其他三个月的所有收藏和购买数据。（这里使用时间窗口为一个月和三个月没有经过实验验证，并不一定是最高效的）

通过这两条过滤规则，去除了大部分样本数据，同时提高了正负样本比例，方便模型训练。

3.训练集与验证集
---
选取预测月份之前的一个月作为未知月份，当做验证集，训练集为过去半年的前五个月数据，并通过步骤2的清洗。模型与超参数选取完毕后，再将过去半年的数据（经过步骤2的清洗）作为训练集重新训练，进行线上预测。

4.特征工程
---
结合业务场景，可以设计出以下特征：

 - 用户特征
    + 转化率特征：购买操作数/所有操作数
    + 活跃度特征：操作频率
 - 商品特征
    + 商品热度特征：购买人数
    + 交互时间特征：用户与商品的交互时间分布
 - 商品类别特征
    + 类别特征：对各个商品进行归类（针对需要推荐的商家，可以简单进行是否属于该商家经营类别产品的分类）
    + 类别热度特征：该类商品在近期（如7天，21天等）内的购买数量
    + 回头客特征：该用户购买该类商品的频率

还可以加入时间相关的特征，考虑到是推荐接下来一个月的用户，时间粒度相对较粗，所以考虑加入当月假期天数，工作日天数，是否有特殊节假日等特征。
此外，可以在这些特征的基础上进行交叉，进行二次特征构造。。。
对于属性特征，进行hot-code处理。

5.模型选择
---
该问题为二分类问题，可以使用SVM, LR, GBDT,随机森林等模型。考虑到需要为商家推荐**一定数量**的用户，所以希望预测结果能够反映用户购买意向的强烈程度，或者说可以反映用户的购买概率，所以希望预测结果为反映概率的连续值。这里可以选取LR或者GBDT。可以都用一下看看效果。
使用之前划分的训练集进行训练，验证集进行验证，找到最优超参数后，使用所有数据进行重新训练，得到模型。

6.预测
---
首先构造测试集，根据特征工程构造与训练集一致的所有特征，有关商品的特征只需要构造待预测商店商品集合的特征即可。将测试集输入模型，得到所有用户关于该商品集合的购买意向预测结果。
将结果按照不同商店的商品集合进行聚合，同一group内的预测结果按照从大到小的顺序排列。根据需要推荐的用户数量n，选取不同group的内的前n名用户推荐给商家。
